# Требования к интеграции сервисов "Умный дом" для PropDevelopment

## 1. Требования к безопасности

### 1.1. Шифрование данных
- Все коммуникации между системами должны использовать **TLS**
- Биометрические данные (изображения лиц) **не должны храниться** в системах PropDevelopment
- Номера автомобилей должны **маскироваться** в логах (например: "А123БС**")

### 1.2. Контроль доступа
- Реализовать **IP-whitelisting** для доступа к API партнера
- Использовать **принцип минимальных привилегий** для всех интеграционных аккаунтов
- Обеспечить **разделение доступа** между разными ЖК (контроль "пересечения" данных)

### 1.3. Нормативное соответствие
- Подписать **NDA** с партнером-поставщиком услуг
- Провести **DPIA** (Data Protection Impact Assessment) для обработки биометрии
- Обеспечить соответствие **152-ФЗ**

## 2. Протоколы аутентификации и авторизации

| Протокол | Где применяется | Требования |
|----------|----------------|------------|
| **OAuth 2.0** (Client Credentials) | API между PropDevelopment и партнером | Срок жизни токена ≤ 1 часа |
| **JWT** | Мобильное приложение → Backend | Алгоритм подписи RS256 |
| **API-Keys** | Сервис → Сервис (внутренние коммуникации) | Ротация ключей ежеквартально |

## 3. Организация взаимодействия систем

### 3.1. Схема интеграции
1. **Мобильное приложение** → (HTTPS/GraphQL) → **Tenant Core App**
   - Запросы на управление устройствами
   - Получение статуса устройств

2. **Tenant Core App** → (REST/HTTPS) → **Умный-дом-адаптер**
   - Проверка прав доступа
   - Трансформация данных в формат партнера

3. **Адаптер** → (OAuth2.0) → **API Gateway** → **Платформа партнера**
   - Вызов внешних API
   - Обработка ошибок
   - API gateway необходим потому что партнёр может изменить API (с REST на gRPC), что сломает интеграцию.
   - Балансировка нагрузки и кеширование. Пиковые нагрузки (утренние часы) могут "положить" API партнёра.

4. **Партнер** → (SFTP) → **Управляющая компания**
   - Ежедневная синхронизация whitelist:
     - Список жильцов с биометрией
     - Номера автомобилей

### 3.2. Требования к API
- **Формат данных**: JSON (UTF-8)
- **Лимиты запросов**: 
  - 100 RPM на пользователя
  - 1000 RPM на интеграционный аккаунт
- **Схемы ответов**:
  ```json
  {
    "request_id": "UUID",
    "status": "success/error",
    "data": {...},
    "error": {"code": "...", "message": "..."}
  }